<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>VIP Energy Charge â€“ High Fidelity</title>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@600;800;1000&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0a091a;
      --accent:#ff75e2;
      --mint:#00ffaa;
      --text:#f6f6ff;
      --stroke: rgba(255,255,255,.12);
      --shadow: 0 26px 70px rgba(0,0,0,.85);
      --glass: rgba(255,255,255,.07);
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; margin:0; overflow:hidden; touch-action: manipulation; }

    body{
      font-family: Inter, system-ui, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1000px 560px at 50% -10%, rgba(255,117,226,.2), transparent 60%),
        linear-gradient(180deg, var(--bg), #05050a);
      display:flex; align-items:center; justify-content:center;
    }

    .wrap{
      width:min(560px, 95%);
      border-radius: 34px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));
      box-shadow: var(--shadow);
      padding: 34px 20px 26px;
      text-align:center;
      position:relative;
      backdrop-filter: blur(10px);
    }

    .topBadge{
      display:inline-flex; align-items:center; gap:10px; padding: 8px 14px;
      border-radius: 999px; border:1px solid rgba(255,255,255,.1);
      background: rgba(0,0,0,.3); font-weight: 900; letter-spacing: 1.6px;
      font-size: 11px; color: var(--accent);
    }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow: 0 0 10px var(--accent); }

    h1{
      font-family: Orbitron; font-size: 28px; margin: 15px 0 5px;
      background: linear-gradient(180deg, #fff, var(--accent));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }

    .sub{
      margin: 0 auto 20px; font-weight: 600; font-size: 13px;
      color: rgba(255,255,255,.6); line-height: 1.5;
    }

    /* --- ENHANCED ENERGY PANEL --- */
    .panel{
      margin-top: 20px; border-radius: 26px; border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.4); padding: 25px 20px; position: relative; overflow:hidden;
    }

    /* The Glass Tube Container */
    .bar-container {
      height: 32px; border-radius: 16px; background: #000;
      border: 1px solid rgba(255,255,255,0.15); box-shadow: inset 0 2px 15px rgba(0,0,0,0.9);
      overflow: hidden; position: relative; margin-bottom: 20px;
    }

    /* Glossy Overlay for Glass effect */
    .bar-container::after {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 50%, rgba(255,255,255,0.05) 100%);
      z-index: 10; pointer-events: none;
    }

    .barFill {
      height: 100%; width: 0%; border-radius: 16px; position: relative;
      background: linear-gradient(90deg, #00ffaa, #00e5ff, #ff75e2, #ff00c1);
      background-size: 300% 100%;
      box-shadow: 0 0 30px rgba(255, 117, 226, 0.5);
      transition: width 0.1s linear; z-index: 2;
    }

    /* Plasma Flow Animation */
    .charging .barFill { animation: plasmaFlow 2s linear infinite; }

    /* The "Spark" at the front of the energy */
    .barFill::after {
      content: ''; position: absolute; right: 0; top: 0; bottom: 0; width: 20px;
      background: #fff; filter: blur(6px); opacity: 0.9;
    }

    /* Glowing Atmosphere */
    .barGlow {
      position: absolute; inset: 0;
      background: radial-gradient(circle at center, var(--accent), transparent);
      opacity: 0; transition: opacity 0.4s; z-index: 1; filter: blur(30px);
    }
    .charging .barGlow { opacity: 0.25; }

    @keyframes plasmaFlow {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    /* Screen Shake for high energy */
    @keyframes shake {
      0% { transform: translate(0,0); }
      25% { transform: translate(1px, -1px); }
      50% { transform: translate(-1.5px, 1px); }
      75% { transform: translate(1px, 0.5px); }
      100% { transform: translate(0,0); }
    }
    .high-power { animation: shake 0.08s infinite; }

    .hud{ display:flex; justify-content:space-between; margin-bottom: 8px; font-family: Orbitron; }
    .label{ font-size: 10px; color: var(--accent); letter-spacing: 2px; text-transform: uppercase; }
    .pct{ font-size: 16px; color: #fff; text-shadow: 0 0 10px var(--accent); }

    /* --- BUTTON STYLES --- */
    .chargeBtn{
      width: 100%; border: none; cursor: pointer; padding: 20px; border-radius: 20px;
      font-weight: 900; letter-spacing: 2px; font-size: 14px;
      background: #fff; color: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      position:relative; overflow:hidden; transition: transform 0.1s;
    }
    .chargeBtn:active{ transform: scale(0.96); }
    .chargeBtn small { display: block; font-size: 10px; opacity: 0.6; margin-top: 4px; }

    .instructions{
      font-size: 12px; margin-bottom: 15px; font-weight: 800; letter-spacing: 1px;
      color: var(--mint); text-transform: uppercase; animation: pulse 1.5s infinite;
    }
    @keyframes pulse{ 0%,100%{ opacity:1 } 50%{ opacity:0.3 } }

    /* MODAL */
    #overlay{
      display:none; position:fixed; inset:0; background: rgba(0,0,0,.95);
      backdrop-filter: blur(20px); z-index:100; align-items:center; justify-content:center;
    }
    .modal{
      background:#fff; color:#111; padding: 40px 30px; border-radius: 30px;
      text-align:center; width: 90%; max-width: 400px;
    }
    .bigPrize{ font-family: Orbitron; font-size: 24px; color:#ff00c1; margin: 15px 0; font-weight: 900; }
    .codeBox{
      background:#f4f4f4; border: 2px dashed #ddd; padding: 15px;
      border-radius: 15px; display:flex; justify-content:space-between; align-items:center;
    }
    .copyBtn{ background:#000; color:#fff; border:none; padding:10px 18px; border-radius:10px; cursor:pointer; font-weight: 900; }

    .disabled{ pointer-events:none; opacity:0.5; filter: grayscale(1); }
  </style>
</head>

<body>

  <div class="wrap" id="mainWrap">
    <div class="topBadge"><span class="dot"></span> VIP SYSTEM ACTIVE</div>

    <h1>ENERGY CHARGE</h1>
    <p class="sub">Hold the trigger to harness the plasma core.<br/>Reach <b>100%</b> to extract your reward.</p>

    <div class="panel" id="panel">
      <div class="hud">
        <div class="label">Reactor Core</div>
        <div class="pct" id="pctText">0%</div>
      </div>

      <div class="bar-container">
        <div class="barGlow"></div>
        <div class="barFill" id="barFill"></div>
      </div>

      <div class="instructions" id="instruction">Ready for ignition</div>

      <button 
        class="chargeBtn" 
        id="chargeBtn"
        onpointerdown="startCharge(event)"
        onpointerup="stopCharge(event)"
        onpointercancel="stopCharge(event)"
        onpointerleave="stopCharge(event)"
      >
        INITIATE CHARGE
        <small>HOLD TO MAINTAIN VOLTAGE</small>
      </button>

      <div id="statusText" style="font-size: 11px; margin-top: 15px; opacity: 0.5;"></div>
    </div>
  </div>

  <div id="overlay">
    <div class="modal">
      <div style="font-size: 10px; font-weight: 900; letter-spacing: 2px; opacity: 0.5;">REACTION COMPLETE</div>
      <div class="bigPrize">MISSION 2 CLEAR</div>
      <div class="codeBox">
        <div style="font-family: monospace; font-size: 20px; font-weight: 900;" id="codeText">-----</div>
        <button class="copyBtn" onclick="copyCode()">COPY</button>
      </div>
      <p style="font-size: 12px; margin-top: 15px; font-weight: 600; color: #666;">Redeem in the <b>Bonus Code</b> section instantly.</p>
    </div>
  </div>

  <audio id="chargeLoop" src="https://assets.mixkit.co/active_storage/sfx/2590/2590-preview.mp3" preload="auto"></audio>

  <script>
    // ===== LOCK + RANDOM CODE (ONE PLAY ONLY) =====
    const LS_KEY = "vip_energy_mission2_claim_v2"; // keep this unique for Mission 2
    const VOUCHER_CODES = ["a22waF", "VdpSVD", "WzGekS"];

    let charge = 0;
    let charging = false;
    let timer = null;
    let hasUnlocked = false;

    const panel = document.getElementById("panel");
    const barFill = document.getElementById("barFill");
    const pctText = document.getElementById("pctText");
    const instruction = document.getElementById("instruction");
    const statusText = document.getElementById("statusText");
    const chargeLoop = document.getElementById("chargeLoop");
    const overlay = document.getElementById("overlay");
    const codeText = document.getElementById("codeText");

    // If already claimed on this device/browser, lock it immediately
    const claimedCode = localStorage.getItem(LS_KEY);
    if (claimedCode) {
      hasUnlocked = true;
      panel.classList.add("disabled");
      instruction.textContent = "ALREADY CLAIMED ON THIS DEVICE";
      statusText.textContent = "";
      // Optional: show the claimed code immediately (comment out if you don't want)
      // codeText.textContent = claimedCode;
      // overlay.style.display = "flex";
    }

    function startCharge(e) {
      if (e) e.preventDefault();
      if (hasUnlocked || localStorage.getItem(LS_KEY)) return;

      charging = true;
      panel.classList.add("charging");
      instruction.textContent = "STABILIZING VOLTAGE...";

      try { chargeLoop.currentTime = 0; chargeLoop.play(); chargeLoop.loop = true; } catch(err) {}

      if (!timer) {
        timer = setInterval(() => {
          if (!charging) return;

          charge = Math.min(100, charge + 1.8);
          render();

          if (charge >= 100) unlock();
        }, 50);
      }
    }

    function stopCharge(e) {
      if (e) e.preventDefault();
      if (hasUnlocked || localStorage.getItem(LS_KEY)) return;

      charging = false;
      panel.classList.remove("charging", "high-power");

      try { chargeLoop.pause(); chargeLoop.currentTime = 0; } catch(err) {}

      if (charge < 100) {
        charge = 0;
        render();
        instruction.textContent = "VOLTAGE LOST - RETRY";
      }
    }

    function render() {
      const val = Math.round(charge);
      pctText.textContent = val + "%";
      barFill.style.width = charge + "%";

      if (charge > 75 && charging) panel.classList.add("high-power");
      else panel.classList.remove("high-power");
    }

    function unlock() {
      if (hasUnlocked) return;

      hasUnlocked = true;
      charging = false;

      clearInterval(timer);
      timer = null;

      panel.classList.remove("charging", "high-power");

      try { chargeLoop.pause(); chargeLoop.currentTime = 0; } catch(err) {}

      // Pick 1 of 3 codes and store it so this device can only play once
      const code = pickVoucherCode();
      codeText.textContent = code;

      confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

      overlay.style.display = "flex";
      panel.classList.add("disabled");
      instruction.textContent = "ALREADY CLAIMED ON THIS DEVICE";
    }

    function pickVoucherCode() {
      const existing = localStorage.getItem(LS_KEY);
      if (existing) return existing;

      const code = VOUCHER_CODES[Math.floor(Math.random() * VOUCHER_CODES.length)];
      localStorage.setItem(LS_KEY, code);
      return code;
    }

    function copyCode() {
      const txt = codeText.innerText;
      navigator.clipboard.writeText(txt).then(() => {
        const btn = document.querySelector(".copyBtn");
        btn.innerText = "COPIED!";
        setTimeout(() => btn.innerText = "COPY", 2000);
      }).catch(() => {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand("copy"); } catch(e){}
        document.body.removeChild(ta);

        const btn = document.querySelector(".copyBtn");
        btn.innerText = "COPIED!";
        setTimeout(() => btn.innerText = "COPY", 2000);
      });
    }
  </script>
</body>
</html>
